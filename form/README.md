# 参考
下記サイトを参考に作りました。
改変しておりますが、基本的な動きは踏襲しておりますので、参考にして下さい。
https://gray-code.com/php/make-the-form-introduction/

# 詳細説明
入力ページ → 確認画面 → サンクスページ
上記の順に画面が切り替わります。

コンバージョン数を確認できるように、サンクスページのみページが遷移します。
CVタグを仕込む際はthanks.phpにタグを挿入ください。

フォームの仕組みに関しては、各フォームのボタンのname値に関して、特定のものを検知した際に$page_flagが反応して内容が変わります。
※form-setup.phpに画面遷移やメール送信に関しての内容が記述してあります。

入力画面(form.php)の際は「btn_confirm」を検知すると確認画面へ。
確認画面(confirm.php)の際は「btn_submit」を検知するとサンクスページへ遷移します。

確認画面で前ページへ戻る場合は、戻るボタンに「onclick="history.back()"」を付与して戻れるようにしております。

入力画面と確認画面に関してはindex.phpの中でincの中にあるファイルをinclude関数で読み込んでいるので、
index.phpの中で内容が変わるので、ページ自体は遷移しません。

サンクスページに関してはheader関数でページを飛ばしています。(先述の通り、cvタグの関係上)

メールに関しては、確認画面にて、送信ボタンを押した際にname属性のbtn_submitを検知すると$page_flagが3に変わり、メール送信のプログラムが発火します。
メール送信に伴い、csvにもユーザーが入力した内容が吐き出されます。(form-setup.phpに記述があります。)

csvに関しては、サーバーに空のcsvファイルをアップしてください(index.phpと同じ階層)。
また、パーミッションを書き込み、実行可能な状態にFTPで変更してください。

source treeにて、csvは文字コードがSJISのため、別途設定する必要があります。
gitフォルダ>configファイルの中に

[diff "cp932"]
    textconv=iconv -f cp932 -t utf-8
[diff "sjis"]
    textconv=iconv -f sjis -t utf-8

上記コードを追加してください。

また、gitフォルダと同階層に
.gitattributesというファイルを作り、中に
*.csv diff=sjis
の記述を追加してください。

バリデーションに関しては、Jqueryのvalidationプラグインを使用しています。
js/form.jsの中にそれぞれの内容を記述しています。下記URL参照。

https://www.sejuku.net/blog/44470


フォームの多重送信を予防するためにsession関数を使用していますが、
サーバーの環境に応じて使えない可能性あります。
状況にあわせてご利用ください。

サーバーの環境に応じてメールが送信できなかったり文字化けする可能性あります。　
状況に応じてサーバーにmb_send_mailが使えるか、mbstringの設定を確認する必要があります。
　
cssに関しては自由に改変してご利用ください。




